# ここからの手順（10問をランダムに出題するまで）

アプリで「**Excel に登録した問題をすべて読み込み、その中からランダムに10問**」が出題されるようにするための手順です。  
（例: レベル1に100問入れておけば、毎回その全100問から10問が抽選されます。）

---

## 前提

- 作業するフォルダ: `c:\Users\hurri\OneDrive\デスクトップ\問題と苦しみ関連\mondai-kurushimi-quiz`
- このフォルダで **PowerShell** または **ターミナル** を開いてコマンドを実行します。

---

## 手順

### ステップ 1: コードの変更を push する（まだの場合）

`app.py` を変更したあと、まだ push していない場合だけ実行します。

```powershell
cd "c:\Users\hurri\OneDrive\デスクトップ\問題と苦しみ関連\mondai-kurushimi-quiz"
git status
```

`app.py` が「変更されています」と出たら、次を実行します。

```powershell
git add app.py
git commit -m "Excel全件読み込みからランダム10問抽選に修正"
git push origin main
```

すでに push 済みの場合はこのステップは飛ばしてOKです。

---

### ステップ 2: 「問題と苦しみ.xlsx」を用意する

**アプリは Excel の NO1・NO2 シートの行を 1 件も漏らさず読み込み、その全件をプールとして、そこからランダムに10問を抽選します。**

- **10問出題したい場合** → NO1・NO2 にそれぞれ **10 行以上** 入れる。
- **100問入れておく場合** → 毎回「全100問からランダムに10問」が選ばれる（行数制限なし）。

#### 方法A: サンプルで 10 問入り Excel を作る

1. **「問題と苦しみ.xlsx」を Excel で開いていたら閉じる。**
2. このフォルダで **create_sample_excel.py** をダブルクリックして実行する。  
   （またはターミナルで `python create_sample_excel.py`）
3. 同じフォルダに **「問題と苦しみ.xlsx」**（NO1・NO2 各10行）ができる。
4. 表示された「Enter キーを押すと閉じます...」で Enter を押して終了。

#### 方法B: 自分で作った Excel を使う

- 使いたい Excel を **「問題と苦しみ.xlsx」** の名前でこのフォルダにコピーする。
- **NO1 シート**（レベル1用）と **NO2 シート**（レベル2用）に、それぞれ **出来事・問題・苦しみ・回答** の列で **10 行以上**（100問など増やしても可）入れる。

---

### ステップ 3: Excel を Git に追加して push する

ターミナルで、このフォルダにいることを確認してから実行します。

```powershell
cd "c:\Users\hurri\OneDrive\デスクトップ\問題と苦しみ関連\mondai-kurushimi-quiz"
git add "問題と苦しみ.xlsx"
git status
```

「問題と苦しみ.xlsx」が new file や変更として出ていればOKです。

```powershell
git commit -m "問題と苦しみ.xlsx を同梱（全件読み込み→ランダム10問出題用）"
git push origin main
```

---

### ステップ 4: 再デプロイを待って確認する

1. **1〜3 分ほど待つ**（Streamlit Cloud が自動で再デプロイします）。
2. **スマホまたはPC** でアプリの URL を開き直す（タブを閉じて開き直すか、更新）。
3. **レベル1 または レベル2** を選んで「テスト開始（10問）」を押す。
4. **10問がランダムに出題される**ことを確認する。  
   - Excel に 100 問入っていれば「読み込み済み: レベル1＝100件」と出て、**その全100問から毎回ランダムに10問**が選ばれます。  
   - 「もう一度テストを始める」で、別の10問・別の順番になることを確認できます。

---

## コピペ用（まとめて実行）

すでに「問題と苦しみ.xlsx」がこのフォルダにあり、NO1・NO2 に必要な行数が入っている場合:

```powershell
cd "c:\Users\hurri\OneDrive\デスクトップ\問題と苦しみ関連\mondai-kurushimi-quiz"
git add app.py "問題と苦しみ.xlsx"
git commit -m "Excel全件読み込みからランダム10問抽選とExcel同梱"
git push origin main
```

※ 1行目は、すでにこのフォルダでターミナルを開いている場合は不要です。

---

## うまくいかないとき

| 状況 | 対処 |
|------|------|
| まだ 2 問しか出ない | Excel の NO1・NO2 がそれぞれ 10 行以上か確認。create_sample_excel.py を実行し直してから再度 add → commit → push。 |
| push でエラー | `git pull origin main` を実行してから、再度 `git add` → `commit` → `push`。 |
| ログインを求められる | パスワード欄には **GitHub の Personal Access Token** を入力する（通常のパスワードでは不可）。 |

ここまでの手順で、URL から開いたアプリで **Excel の全件を読み込み、その中からランダムに10問** が出題される状態になります。

---

## 変化しないときの確認（同じ問題が繰り返されるとき）

1. **アプリで「読み込み済み」の表示を確認する**  
   難易度選択の上に **「読み込み済み: レベル1＝〇件、レベル2＝〇件」** が出ます。  
   - **2件・2件のまま** → サーバーで使われている Excel がまだ古い（2行のまま）です。
   - **100問入れたのに 10 件と出る** → その場合は Excel の行数（見出し除く）を確認。100行あれば「レベル1＝100件」と出ます。
2. **GitHub で 問題と苦しみ.xlsx を確認する**  
   - https://github.com/Doraemon9999/mondai-kurushimi-quiz を開く  
   - 一覧に **「問題と苦しみ.xlsx」** があるか  
   - クリックして **「Download」** でダウンロードし、Excel で開いて **NO1・NO2 の行数**（見出し除く）を確認
3. **行数が足りない／想定と違う場合**  
   - 手元の **mondai-kurushimi-quiz** フォルダで **create_sample_excel.py** を実行するか、Excel を編集して行数を増やす（「問題と苦しみ.xlsx」は閉じておく）  
   - できた **「問題と苦しみ.xlsx」** を必ず **git add** して **push** する  
   ```powershell
   git add "問題と苦しみ.xlsx"
   git status
   git commit -m "問題と苦しみ.xlsx を更新"
   git push origin main
   ```
4. **push 後**  
   - 1〜3分待ってから、アプリの URL を**タブを閉じて開き直す**（キャッシュを避ける）  
   - 再度「読み込み済み」が **用意した Excel の NO1・NO2 の行数と一致しているか** 確認（例: レベル1＝10件・レベル2＝10件、または レベル1＝100件・レベル2＝〇件）

